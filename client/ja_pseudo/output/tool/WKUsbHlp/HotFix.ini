; HotFix.ini template for TMSL 2.0
;###############################################################
; Purposes of using TmPatch.exe ver. 2.0
; - Check OS type (%OS_TYPE%).  (WIN95,WIN98,WINME,NT351,NT4,WIN2K,WINXP,WIN.NET,
;WIN7_32,WIN7_64,WIN_2008_R2_32,WIN_2008_R2_64,WIN8_0_32,WIN8_0_64,WIN2012_64,
;WIN8_1_32,WIN8_1_64,WIN2012_R2_64)
; - Copy files to various folders.
; - Check if the reboot is necessary (Global Symbol %NEED_REBOOT%).
; - Take a debug log (TMPatch.exe /T).
; - Not take a debug log (TMPatch.exe -m).
; - Run WKMc32/64.exe and check the return code.
;###############################################################

;----------------------------------------------------------------------------------------
; Internal Definitions
; - DO NOT MODIFY EXECUTION SEQUENCE EXCEPT FOR [TODO] SECTIONS.
;----------------------------------------------------------------------------------------
[ProductInstall.Symbols]
RETCODE_S_OK=0
DEF_NEEDREBOOT=1
DEF_PRODUCT_TITLE="Trend Micro Safe Lock"
DEF_HOTFIX_DESC="Trend Micro USB Security Launcher for Trend Micro Safe Lock"
TITLE_WINDOW=%DEF_PRODUCT_TITLE%

DEF_REG_PRODUCT_PATH=[Reg:REG_SZ,HKLM,SOFTWARE\TrendMicro\SafeLock,InstalledFolder]
DEF_REG_PRODUCT_VERSION=[Reg:REG_SZ,HKLM,SOFTWARE\TrendMicro\SafeLock,Version]
DEF_REG_PRODUCT_TITLE=[Reg:REG_SZ,HKLM,SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{F12711A3-26ED-40c8-8ECB-2F2174313F6B},DisplayName]
DEF_REG_LANGUAGE_ID=[Reg:REG_DWORD,HKLM,SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{F12711A3-26ED-40c8-8ECB-2F2174313F6B},Language]
DEF_REG_FW_INSTALLED=[Reg:REG_DWORD,HKLM,SOFTWARE\TrendMicro\SafeLock\2\WKSrv\FireWall,Installed]
DEF_PRODUCT_VER_FILE=[FileInfo:%DEF_REG_PRODUCT_PATH%WKSrv.exe,FileVersion]
DEF_PRODUCT_VER_BUILD=[FileInfo:%DEF_REG_PRODUCT_PATH%WKSrv.exe,BuildVersion]
DEF_HELPER_VER_FILE=[FileInfo:%DEF_REG_PRODUCT_PATH%WKUsbHlp.exe,FileVersion]
DEF_MODULE_NAME=WKMc32.exe
DEF_HELPER_NAME=WKUsbHlp.exe
DEF_WKSRV_NAME=WKSrv.exe

DEF64_REG_PRODUCT_PATH=[Reg:REG_SZ,HKLM,SOFTWARE\TrendMicro\SafeLock,InstalledFolder,x64]
DEF64_REG_PRODUCT_VERSION=[Reg:REG_SZ,HKLM,SOFTWARE\TrendMicro\SafeLock,Version,x64]
DEF64_REG_PRODUCT_TITLE=[Reg:REG_SZ,HKLM,SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{F12711A3-26ED-40c8-8ECB-2F2174313F6B},DisplayName,x64]
DEF64_REG_LANGUAGE_ID=[Reg:REG_DWORD,HKLM,SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{F12711A3-26ED-40c8-8ECB-2F2174313F6B},Language,x64]
DEF64_REG_FW_INSTALLED=[Reg:REG_DWORD,HKLM,SOFTWARE\TrendMicro\SafeLock\2\WKSrv\FireWall,Installed,x64]
DEF64_PRODUCT_VER_FILE=[FileInfo:%DEF64_REG_PRODUCT_PATH%WKSrv.exe,FileVersion]
DEF64_PRODUCT_VER_BUILD=[FileInfo:%DEF64_REG_PRODUCT_PATH%WKSrv.exe,BuildVersion]
DEF64_HELPER_VER_FILE=[FileInfo:%DEF64_REG_PRODUCT_PATH%WKUsbHlp.exe,FileVersion]
DEF64_MODULE_NAME=WKMc64.exe
DEF64_HELPER_NAME=WKUsbHlp.exe

;[TODO] Add extra Symbols here
SystemRoot=%SYSWINDIR%
System32=%SystemRoot%\System32
Driver=%System32%\Drivers

DEF_PRODUCT_REG_KEY=SOFTWARE\TrendMicro\SafeLock
DEF_PRODUCT_VERSION_REG_KEY=%DEF_PRODUCT_REG_KEY%\2
DEF_WKSRV_REG_KEY=%DEF_PRODUCT_VERSION_REG_KEY%\WKSrv
DEF_LOCKDOWN_REG_KEY=%DEF_WKSRV_REG_KEY%\LockdownManager
DEF_AEGIS_EXCEPTION_CONTROL_REG_KEY=%DEF_LOCKDOWN_REG_KEY%\AegisExceptionControl
DEF_AEGIS_EXCEPTION_CONTROL_HELPER_REG_KEY=%DEF_AEGIS_EXCEPTION_CONTROL_REG_KEY%\%DEF_HELPER_NAME%
DEF_AEGIS_EXCEPTION_CONTROL_STATUS_NON_EXCEPTION=0
DEF_AEGIS_EXCEPTION_CONTROL_STATUS_EXCEPTION=1

DEF_AEGIS_SOFTWARE_REG_KEY=SOFTWARE\TrendMicro\Aegis
DEF_AEGIS_SYSTEM_REG_KEY=SYSTEM\CurrentControlSet\services

;----------------------------------------------------------------------------------------
; Support Definitions
;----------------------------------------------------------------------------------------
DEF_SUPPORT_PRODUCT_TITLE=%DEF_PRODUCT_TITLE%

;[TODO] Select:EN=1033,JA=1041
DEF_SUPPORT_LANGUAGE_ID=1041

;[TODO] Select versions
DEF_SUPPORT_PRODUCT_VERSION_MIN=2.00
DEF_SUPPORT_PRODUCT_VERSION_MAX=2.00
DEF_SUPPORT_PRODUCT_VER_BUILD_MIN=0000
DEF_SUPPORT_PRODUCT_VER_BUILD_MAX=9999
DEF_SUPPORT_HELPER_VERSION_INVALID=

;[TODO] Set flags (0=Skip,1=Show)
;DEF_SUPPORT_NEEDREBOOT=0

;----------------------------------------------------------------------------------------
; Message string definition
;----------------------------------------------------------------------------------------
DESC_CHECK_REQUIREMENT="構成を確認しています ..."
DESC_UPDATE_FINISHED="アップデートが完了しました。"
DESC_UPDATE_FAILED="アップデートに失敗しました。"
DESC_UPDATE_CANCEL="アップデートがキャンセルされました。"
MSG_SHOW_ADMINISTRATOR_REQUIRED="このソフトウェアは管理者のみ実行できます。"
MSG_SHOW_NOT_COMPATIBLE="このアップデートは現在インストールされているソフトウェアには適用できません。"
MSG_SHOW_REBOOT_NEEDED="アップデートを完了するには、システムを再起動してください。"
MSG_SHOW_CLOSE_UI="Trend Micro Safe Lockのメイン画面を閉じてから実行してください。"
MSG_SHOW_LOGOUT_SESSION="他のユーザがログオン状態です。"
MSG_STOP_TMSL=" サービスを停止しています ..."
MSG_START_TMSL=" サービスを開始しています ..."
MSG_COPY_FILES=" ファイルをコピーしています ..."
MSG_DELETE_FILES=" ファイルを削除しています ..."
MSG_CHECK_OS="-> システム: "
MSG_CHECK_ADMIN="-> アカウント: "
MSG_CHECK_SESSION="-> ユーザセッション: "
MSG_CHECK_VERSION="-> 製品バージョン: "
MSG_CHECK_NAME="-> 製品名: "
MSG_CHECK_LANG="-> 言語: "
MSG_CHECK_REBOOT="-> 再起動: "
MSG_HELPER_REGISTER="-> プログラムを登録しています ..."
MSG_HELPER_START="-> プログラムを開始しています ..."
MSG_HELPER_STOP="-> プログラムを停止しています ..."
MSG_UPDATE_REGISTRY="-> レジストリ情報を更新しています ..."

;----------------------------------------------------------------------------------------
; File Locations
;----------------------------------------------------------------------------------------
; 32-bit
; file list
[FileGroup10]
Description=%MSG_COPY_FILES%
Target=%DEF_REG_PRODUCT_PATH%\
Backup=%SOURCEDIR%Backup10\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=2
File1=%DEF_HELPER_NAME%
File2=WKUsbHlp.xen

[FileGroup11]
Description=%MSG_COPY_FILES%
Target=%DEF_REG_PRODUCT_PATH%\Patterns\
Backup=%SOURCEDIR%Backup11\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmlocfg.ptn

[FileGroup12]
Description=%MSG_COPY_FILES%
Target=%DEF_REG_PRODUCT_PATH%\Drivers\
Backup=%SOURCEDIR%Backup12\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmactmon.cat
;File2=tmactmon.inf
;File3=tmactmon.sys
;File4=tmcomm.cat
;File5=tmcomm.inf
;File6=tmcomm.sys
;File7=tmevtmgr.cat
;File8=tmevtmgr.inf
;File9=tmevtmgr.sys

[FileGroup13]
Description=%MSG_COPY_FILES%
Target=%Driver%\
Backup=%SOURCEDIR%Backup13\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmactmon.sys
;File2=tmcomm.sys
;File3=tmevtmgr.sys

; if FW installed, files for 2k and xp
[FileGroup14]
Description=%MSG_COPY_FILES%
Target=%DEF_REG_PRODUCT_PATH%\Drivers\
Backup=%SOURCEDIR%Backup14\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tm_cfw.sys

[FileGroup15]
Description=%MSG_COPY_FILES%
Target=%Driver%\
Backup=%SOURCEDIR%Backup15\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tm_cfw.sys

; if FW installed, files for vista and later
[FileGroup16]
Description=%MSG_COPY_FILES%
Target=%DEF_REG_PRODUCT_PATH%\Drivers\
Backup=%SOURCEDIR%Backup16\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmwfp.sys
;File2=tmlwf.sys

[FileGroup17]
Description=%MSG_COPY_FILES%
Target=%Driver%\
Backup=%SOURCEDIR%Backup17\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmwfp.sys
;File2=tmlwf.sys

[FileGroup18]
Description=%MSG_COPY_FILES%
Target=%DEF_REG_PRODUCT_PATH%\McAgnt\
Backup=%SOURCEDIR%Backup18\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=TmMcAgnt.dll

[FileGroup19]
Description=%MSG_COPY_FILES%
Target=%DEF_REG_PRODUCT_PATH%\TMLCE\
Backup=%SOURCEDIR%Backup19\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=TMLCE.ptn

[FileGroup20]
Description=%MSG_COPY_FILES%
Target=%DEF_REG_PRODUCT_PATH%\TMLES\
Backup=%SOURCEDIR%Backup20\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=TMLES.ptn

; file list for 64 bit
[FileGroup60]
Description=%MSG_COPY_FILES%
Target=%DEF64_REG_PRODUCT_PATH%\
Backup=%SOURCEDIR%Backup60\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=2
File1=%DEF64_HELPER_NAME%
File2=WKUsbHlp.xen

[FileGroup61]
Description=%MSG_COPY_FILES%
Target=%DEF64_REG_PRODUCT_PATH%\Patterns\
Backup=%SOURCEDIR%Backup61\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmlocfg.ptn

[FileGroup62]
Description=%MSG_COPY_FILES%
Target=%DEF64_REG_PRODUCT_PATH%\Drivers\
Backup=%SOURCEDIR%Backup62\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmactmon.cat
;File2=tmactmon.inf
;File3=tmactmon.sys
;File4=tmcomm.cat
;File5=tmcomm.inf
;File6=tmcomm.sys
;File7=tmevtmgr.cat
;File8=tmevtmgr.inf
;File9=tmevtmgr.sys

[FileGroup63]
Description=%MSG_COPY_FILES%
Target=%Driver%\
Backup=%SOURCEDIR%Backup63\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmactmon.sys
;File2=tmcomm.sys
;File3=tmevtmgr.sys

; FW installed, files for 2k and xp
[FileGroup64]
Description=%MSG_COPY_FILES%
Target=%DEF64_REG_PRODUCT_PATH%\Drivers\
Backup=%SOURCEDIR%Backup64\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tm_cfw.sys

[FileGroup65]
Description=%MSG_COPY_FILES%
Target=%Driver%\
Backup=%SOURCEDIR%Backup65\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tm_cfw.sys

; FW installed, files for vista and later
[FileGroup66]
Description=%MSG_COPY_FILES%
Target=%DEF64_REG_PRODUCT_PATH%\Drivers\
Backup=%SOURCEDIR%Backup66\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmwfp.sys
;File2=tmlwf.sys

[FileGroup67]
Description=%MSG_COPY_FILES%
Target=%Driver%\
Backup=%SOURCEDIR%Backup67\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=tmwfp.sys
;File2=tmlwf.sys


[FileGroup68]
Description=%MSG_COPY_FILES%
Target=%DEF64_REG_PRODUCT_PATH%\McAgnt\
Backup=%SOURCEDIR%Backup68\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=TmMcAgnt.dll

[FileGroup69]
Description=%MSG_COPY_FILES%
Target=%DEF64_REG_PRODUCT_PATH%\TMLCE\
Backup=%SOURCEDIR%Backup69\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=TMLCE.ptn

[FileGroup70]
Description=%MSG_COPY_FILES%
Target=%DEF64_REG_PRODUCT_PATH%\TMLES\
Backup=%SOURCEDIR%Backup70\
OnCopyFail=TMHF_CopyFailRemoveReadonlyAndReboot
FileCount=0
;File1=TMLES.ptn

;----------------------------------------------------------------------------------------
; Execution Sequences
; - DO NOT MODIFY EXECUTION SEQUENCE EXCEPT FOR [TODO] SECTIONS.
;----------------------------------------------------------------------------------------
[ProductInstall.Main]
MainDescription=%DEF_HOTFIX_DESC%
WelcomeWindowTitle=%TITLE_WINDOW%
SetupWindowTitle=%TITLE_WINDOW%
ReadmeFile=Readme.txt

StepCount=100

; check 64-bit environment
Step1.Section=ProductInstall.CheckRequirement.1
Step1.Description=%DESC_CHECK_REQUIREMENT%

; 32-bit steps
; check supported os/admin
Step2.Section=ProductInstall.CheckRequirement.2
Step2.Description=%DESC_CHECK_REQUIREMENT%

; check version/language/code/id
Step10.Section=ProductInstall.CheckRequirement.10
Step10.Description=%DESC_CHECK_REQUIREMENT%

; copy shared files
Step11.Section=ProductInstall.Run.11
Step11.Description=%MSG_COPY_FILES%
; check session
Step12.Section=ProductInstall.Run.12
Step12.Description=%DESC_CHECK_REQUIREMENT%
Step13.Section=ProductInstall.CheckRequirement.13
Step13.Description=%DESC_CHECK_REQUIREMENT%

; stop helper
Step14.Section=ProductInstall.CheckRequirement.14
Step14.Description=" "
Step15.Section=ProductInstall.Run.15
Step15.Description=%DEF_PRODUCT_TITLE%
Step16.Section=ProductInstall.CheckRequirement.16
Step16.Description=" "

; stop product
Step17.Section=ProductInstall.Run.17
Step17.Description=%MSG_STOP_TMSL%
Step18.Section=ProductInstall.CheckRequirement.18
Step18.Description=%MSG_STOP_TMSL%
Step19.Section=ProductInstall.Run.19
Step19.Description=%MSG_STOP_TMSL%

; copy files
Step20.Section=ProductInstall.CopyFileGroupTo.10
Step20.Description=%MSG_COPY_FILES%
;Step21.Section=ProductInstall.CopyFileGroupTo.11
;Step21.Description=%MSG_COPY_FILES%
;Step22.Section=ProductInstall.CopyFileGroupTo.12
;Step22.Description=%MSG_COPY_FILES%
;Step23.Section=ProductInstall.CopyFileGroupTo.13
;Step23.Description=%MSG_COPY_FILES%
Step21.Section=ProductInstall.CopyFileGroupTo.18
Step21.Description=%MSG_COPY_FILES%

; branch on os
Step24.Section=ProductInstall.CheckRequirement.24
Step24.Description=%DESC_CHECK_REQUIREMENT%

Step25.Section=ProductInstall.CopyFileGroupTo.14
Step25.Description=%MSG_COPY_FILES%
Step26.Section=ProductInstall.CopyFileGroupTo.15
Step26.Description=%MSG_COPY_FILES%

Step27.Section=ProductInstall.CheckRequirement.28
Step27.Description=%DESC_CHECK_REQUIREMENT%

Step28.Section=ProductInstall.CopyFileGroupTo.16
Step28.Description=%MSG_COPY_FILES%
Step29.Section=ProductInstall.CopyFileGroupTo.17
Step29.Description=%MSG_COPY_FILES%

; update reg
Step30.Section=ProductInstall.UpdateRegistry.30
Step30.Description=%DEF_PRODUCT_TITLE%

; register helper
Step31.Section=ProductInstall.Run.31
Step31.Description=%DEF_PRODUCT_TITLE%
Step32.Section=ProductInstall.CheckRequirement.32
Step32.Description=" "

; start helper
Step33.Section=ProductInstall.Run.33
Step33.Description=%DEF_PRODUCT_TITLE%
Step34.Section=ProductInstall.CheckRequirement.34
Step34.Description=" "

; start product
Step35.Section=ProductInstall.Run.35
Step35.Description=%DEF_PRODUCT_TITLE%

; delete shared files
Step39.Section=ProductInstall.Run.39

; reboot message
Step40.Section=ProductInstall.CheckRequirement.40
Step40.Description=%MSG_CHECK_REBOOTT%

; last step 
; Show program/engine/pattern versions
Step44.Section=ProductInstall.CheckRequirement.44
Step44.Description=" "
Step45.Section=ProductInstall.CheckRequirement.45
Step45.Description=" "

; error break steps
Step47.Section=ProductInstall.Run.47
Step47.Description=%MSG_DELETE_FILES%
Step48.Section=ProductInstall.CheckRequirement.48
Step48.Description=%DESC_UPDATE_FINISHED%

; 64-bit steps
; check supported os
Step51.Section=ProductInstall.CheckRequirement.51
Step51.Description=%DESC_CHECK_REQUIREMENT%

; check version/language/code/id
Step60.Section=ProductInstall.CheckRequirement.60
Step60.Description=%DESC_CHECK_REQUIREMENT%

; copy shared files
Step61.Section=ProductInstall.Run.61
Step61.Description=%MSG_COPY_FILES%
; check session
Step62.Section=ProductInstall.Run.62
Step62.Description=%DESC_CHECK_REQUIREMENT%
Step63.Section=ProductInstall.CheckRequirement.63
Step63.Description=" "

; stop helper
Step64.Section=ProductInstall.CheckRequirement.64
Step64.Description=" "
Step65.Section=ProductInstall.Run.65
Step65.Description=%DEF_PRODUCT_TITLE%
Step66.Section=ProductInstall.CheckRequirement.66
Step66.Description=" "

; stop product
Step67.Section=ProductInstall.Run.67
Step67.Description=%MSG_STOP_TMSL%
Step68.Section=ProductInstall.CheckRequirement.68
Step68.Description=%MSG_STOP_TMSL%
Step69.Section=ProductInstall.Run.69
Step69.Description=%MSG_STOP_TMSL%

; copy files
Step70.Section=ProductInstall.CopyFileGroupTo.60
Step70.Description=%MSG_COPY_FILES%
;Step71.Section=ProductInstall.CopyFileGroupTo.61
;Step71.Description=%MSG_COPY_FILES%
;Step72.Section=ProductInstall.CopyFileGroupTo.62
;Step72.Description=%MSG_COPY_FILES%
;Step73.Section=ProductInstall.CopyFileGroupTo.63
;Step73.Description=%MSG_COPY_FILES%
Step71.Section=ProductInstall.CopyFileGroupTo.68
Step71.Description=%MSG_COPY_FILES%

; branch on os
Step74.Section=ProductInstall.CheckRequirement.74
Step74.Description=%DESC_CHECK_REQUIREMENT%

Step75.Section=ProductInstall.CopyFileGroupTo.64
Step75.Description=%MSG_COPY_FILES%
Step76.Section=ProductInstall.CopyFileGroupTo.65
Step76.Description=%MSG_COPY_FILES%

Step77.Section=ProductInstall.CheckRequirement.78
Step77.Description=%DESC_CHECK_REQUIREMENT%

Step78.Section=ProductInstall.CopyFileGroupTo.66
Step78.Description=%MSG_COPY_FILES%
Step79.Section=ProductInstall.CopyFileGroupTo.67
Step79.Description=%MSG_COPY_FILES%

; update reg
Step80.Section=ProductInstall.UpdateRegistry.80
Step80.Description=%DEF_PRODUCT_TITLE%

; register helper
Step81.Section=ProductInstall.Run.81
Step81.Description=%DEF_PRODUCT_TITLE%
Step82.Section=ProductInstall.CheckRequirement.82
Step82.Description=" "

; start helper
Step83.Section=ProductInstall.Run.83
Step83.Description=%DEF_PRODUCT_TITLE%
Step84.Section=ProductInstall.CheckRequirement.84
Step84.Description=" "

; start product
Step85.Section=ProductInstall.Run.85
Step85.Description=%DEF_PRODUCT_TITLE%

; delete shared files
Step89.Section=ProductInstall.Run.89

; reboot message
Step90.Section=ProductInstall.CheckRequirement.90
Step90.Description=%MSG_CHECK_REBOOTT%

; last step
; Show program/engine/pattern versions
Step94.Section=ProductInstall.CheckRequirement.94
Step94.Description=" "
Step95.Section=ProductInstall.CheckRequirement.95
Step95.Description=" "

; error break steps
Step97.Section=ProductInstall.Run.97
Step97.Description=%MSG_DELETE_FILES%
Step98.Section=ProductInstall.CheckRequirement.98
Step98.Description=%DESC_UPDATE_FINISHED%

Step100.Section=ProductInstall.Run.100

;========================================================================================
; check 32/64-bit environment. (32bit:continue, 64-bit:go to block(50))
;========================================================================================
[ProductInstall.CheckRequirement.1]
CheckCount=1
Check1.Description=%MSG_CHECK_OS%
Check1.String=%OS_TYPE%
Check1.String.List=WIN.NET64,VISTA64,WIN7_64,WIN2008_64,WIN2008_R2_64,WIN8_0_64,WIN8_1_64,WIN8_0_64,WIN2012_64,WIN2012_R2_64
Check1.Success.Action=TMHF_GOTOSTEP(50)
Check1.Error.Action=TMHF_CONTINUE
;========================================================================================
; 32-bit step block
;========================================================================================
;----------------------------------------------------------------------------------------
; 32bit Initialization
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.2]
CheckCount=2
Check1.Description=%MSG_CHECK_OS%
Check1.String=%OS_TYPE%
Check1.String.List=WIN2K,WINXP,WIN.NET,VISTA32,WIN2008_32,WIN7_32,WIN2008_R2_32,WIN8_0_32,WIN8_1_32
Check1.Success.Action=TMHF_CONTINUE
;Check1.Error.Action=TMHF_GOTOSTEP(47)
Check1.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check1.Error.OK=TMHF_GOTOSTEP(48)
Check1.Error.Default=TMHF_GOTOSTEP(48)
Check2.Description=%MSG_CHECK_ADMIN%
Check2.String=%LOGIN_ACCOUNT%
Check2.String.List=ADMIN
Check2.Success.Action=TMHF_CONTINUE
Check2.Error.AskOK=%MSG_SHOW_ADMINISTRATOR_REQUIRED%
Check2.Error.OK=TMHF_GOTOSTEP(48)
Check2.Error.Default=TMHF_GOTOSTEP(48)


;----------------------------------------------------------------------------------------
; 32-bit version/language/code/id check
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.10]
CheckCount=4
Check1.Description=%MSG_CHECK_VERSION%
Check1.Number=%DEF_PRODUCT_VER_FILE%
Check1.Number.Min=%DEF_SUPPORT_PRODUCT_VERSION_MIN%
Check1.Number.Max=%DEF_SUPPORT_PRODUCT_VERSION_MAX%
Check1.Success.Action=TMHF_CONTINUE
;Check1.Error.Action=TMHF_GOTOSTEP(46)
Check1.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check1.Error.OK=TMHF_GOTOSTEP(48)
Check1.Error.Default=TMHF_GOTOSTEP(48)
Check2.Description=%MSG_CHECK_VERSION%
Check2.Number=%DEF_PRODUCT_VER_BUILD%
Check2.Number.Min=%DEF_SUPPORT_PRODUCT_VER_BUILD_MIN%
Check2.Number.Max=%DEF_SUPPORT_PRODUCT_VER_BUILD_MAX%
Check2.Success.Action=TMHF_CONTINUE
;Check2.Error.Action=TMHF_GOTOSTEP(46)
Check2.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check2.Error.OK=TMHF_GOTOSTEP(48)
Check2.Error.Default=TMHF_GOTOSTEP(48)
Check3.Description=%MSG_CHECK_NAME%
Check3.String=%DEF_REG_PRODUCT_TITLE%
Check3.String.List=%DEF_SUPPORT_PRODUCT_TITLE%
Check3.Success.Action=TMHF_CONTINUE
;Check3.Error.Action=TMHF_GOTOSTEP(46)
Check3.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check3.Error.OK=TMHF_GOTOSTEP(48)
Check3.Error.Default=TMHF_GOTOSTEP(48)
Check4.Description=%MSG_CHECK_LANG%
Check4.Number=%DEF_REG_LANGUAGE_ID%
Check4.Number.Min=%DEF_SUPPORT_LANGUAGE_ID%
Check4.Number.Max=%DEF_SUPPORT_LANGUAGE_ID%
Check4.Success.Action=TMHF_CONTINUE
;Check4.Error.Action=TMHF_GOTOSTEP(46)
Check4.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check4.Error.OK=TMHF_GOTOSTEP(48)
Check4.Error.Default=TMHF_GOTOSTEP(48)


;----------------------------------------------------------------------------------------
; 32-bit check user session (with Module Control)
;----------------------------------------------------------------------------------------
[ProductInstall.Run.11]
;[TODO] Modify RunCount=2 if you need to copy Shared DLL
RunCount=2
Run1.Path=%SOURCEDIR%
Run1.Command=copy "%DEF_REG_PRODUCT_PATH%*80*.dll" *80*.dll 
Run1.Description=%MSG_COPY_FILES%
Run2.Path=%SOURCEDIR%
Run2.Command=copy "%DEF_REG_PRODUCT_PATH%\Microsoft.VC80.*.manifest" Microsoft.VC80.*.manifest
Run2.Description=%MSG_COPY_FILES%

[ProductInstall.Run.12]
RunCount=1
Run1.Description=%MSG_CHECK_SESSION%
Run1.Path=%SOURCEDIR%
Run1.Command=%DEF_MODULE_NAME% /UserSession
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.13]
CheckCount=1
Check1.Description=%MSG_CHECK_SESSION%
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.Action=TMHF_GOTOSTEP(14)
;Check1.Error.Action=TMHF_GOTOSTEP(47)
Check1.Error.AskOK=%MSG_SHOW_LOGOUT_SESSION%
Check1.Error.OK=TMHF_GOTOSTEP(47)
Check1.Error.Default=TMHF_GOTOSTEP(47)

;----------------------------------------------------------------------------------------
; 32-bit stop helper
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.14]
CheckCount=1
Check1.Description=%MSG_HELPER_STOP%
Check1.Number=%DEF_HELPER_VER_FILE%
Check1.Number.Min=%DEF_SUPPORT_HELPER_VERSION_INVALID%
Check1.Number.Max=%DEF_SUPPORT_HELPER_VERSION_INVALID%
Check1.Success.Action=TMHF_GOTOSTEP(17)
Check1.Error.Action=TMHF_CONTINUE
[ProductInstall.Run.15]
RunCount=1
Run1.Description=%MSG_HELPER_STOP%
Run1.Path=%DEF_REG_PRODUCT_PATH%\
Run1.Command=%DEF_HELPER_NAME% stop
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
Run1.RollbackCommand=%DEF_HELPER_NAME% start
Run1.RollbackCommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.16]
CheckCount=1
Check1.Description=%MSG_HELPER_STOP%
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.Action=TMHF_CONTINUE
Check1.Error.Action=TMHF_GOTOSTEP(47)

;----------------------------------------------------------------------------------------
; 32-bit stop TMWK
;----------------------------------------------------------------------------------------
[ProductInstall.Run.17]
RunCount=1
Run1.Path=%SOURCEDIR%
Run1.Command=%DEF_MODULE_NAME% /CheckUiInstance
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.18]
;if UI instance exist(RETCODE_S_OK), then do not continue
CheckCount=1
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.AskOK=%MSG_SHOW_CLOSE_UI%
Check1.Success.OK=TMHF_GOTOSTEP(47)
Check1.Success.Default=TMHF_GOTOSTEP(47)
Check1.Error.Action=TMHF_CONTINUE
[ProductInstall.Run.19]
RunCount=1
Run1.Description=%MSG_STOP_TMSL%
Run1.Path=%SOURCEDIR%
Run1.Command=%DEF_MODULE_NAME% /Stop
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
Run1.RollbackCommand=%DEF_MODULE_NAME% /Start
Run1.RollbackCommandType=TMHF_RunAtBackgroundAndWaitForReturn

;----------------------------------------------------------------------------------------
; 32-bit branch on os
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.24]
CheckCount=2
Check1.Description=%MSG_CHECK_OS%
Check1.Number=%DEF_REG_FW_INSTALLED%
Check1.Number.Min=1
Check1.Number.Max=1
Check1.Success.Action=TMHF_CONTINUE
Check1.Error.Action=TMHF_GOTOSTEP(30)
Check2.Description=%MSG_CHECK_OS%
Check2.String=%OS_TYPE%
Check2.String.List=WIN2K,WINXP,WIN.NET
Check2.Success.Action=TMHF_CONTINUE
Check2.Error.Action=TMHF_GOTOSTEP(28)


[ProductInstall.CheckRequirement.28]
CheckCount=1
Check1.Description=%MSG_CHECK_OS%
Check1.String=%OS_TYPE%
Check1.String.List=VISTA32,WIN7_32,WIN2008_32,WIN_2008_R2_32,WIN8_0_32,WIN8_1_32
Check1.Success.Action=TMHF_CONTINUE
Check1.Error.Action=TMHF_GOTOSTEP(30)

;----------------------------------------------------------------------------------------
; 32-bit copy files
;----------------------------------------------------------------------------------------
[ProductInstall.CopyFileGroupTo.10]
FileGroupStartCount=10
FileGroupCount=4
[ProductInstall.CopyFileGroupTo.14]
FileGroupStartCount=14
FileGroupCount=2
[ProductInstall.CopyFileGroupTo.16]
FileGroupStartCount=16
FileGroupCount=2
[ProductInstall.CopyFileGroupTo.18]
FileGroupStartCount=18
FileGroupCount=3


;----------------------------------------------------------------------------------------
; 32-bit update registry 
;----------------------------------------------------------------------------------------
[ProductInstall.UpdateRegistry.30]
RegCount=2
Reg1.Description=%MSG_UPDATE_REGISTRY%
Reg1.Key=Reg:REG_SZ,HKLM,%DEF_AEGIS_EXCEPTION_CONTROL_HELPER_REG_KEY%,Path
Reg1.Value=%DEF_REG_PRODUCT_PATH%\%DEF_HELPER_NAME%
Reg2.Description=%MSG_UPDATE_REGISTRY%
Reg2.Key=Reg:REG_DWORD,HKLM,%DEF_AEGIS_EXCEPTION_CONTROL_HELPER_REG_KEY%,Status
Reg2.Value=%DEF_AEGIS_EXCEPTION_CONTROL_STATUS_NON_EXCEPTION%

;----------------------------------------------------------------------------------------
; 32-bit register helper
;----------------------------------------------------------------------------------------
[ProductInstall.Run.31]
RunCount=1
Run1.Description=%MSG_HELPER_REGISTER%
Run1.Path=%DEF_REG_PRODUCT_PATH%\
Run1.Command=%DEF_HELPER_NAME% register
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
Run1.RollbackCommand=%DEF_HELPER_NAME% unregister
Run1.RollbackCommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.32]
CheckCount=1
Check1.Description=%MSG_HELPER_REGISTER%
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.Action=TMHF_GOTOSTEP(33)
Check1.Error.Action=TMHF_GOTOSTEP(47)

;----------------------------------------------------------------------------------------
; 32-bit start helper
;----------------------------------------------------------------------------------------
[ProductInstall.Run.33]
RunCount=1
Run1.Description=%MSG_HELPER_START%
Run1.Path=%DEF_REG_PRODUCT_PATH%\
Run1.Command=%DEF_HELPER_NAME% start
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
Run1.RollbackCommand=%DEF_HELPER_NAME% stop
Run1.RollbackCommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.34]
CheckCount=1
Check1.Description=%MSG_HELPER_START%
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.Action=TMHF_GOTOSTEP(35)
Check1.Error.Action=TMHF_GOTOSTEP(47)

;----------------------------------------------------------------------------------------
; 32-bit start TMWK
;----------------------------------------------------------------------------------------
[ProductInstall.Run.35]
RunCount=1
Run1.Description=%MSG_START_TMSL%
Run1.Path=%SOURCEDIR%
Run1.Command=%DEF_MODULE_NAME% /Start
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn

;----------------------------------------------------------------------------------------
; 32-bit update
;----------------------------------------------------------------------------------------
[ProductInstall.Run.39]
;[TODO] Modify RunCount=2 if you need to delete Shared DLL
RunCount=0
Run1.Description=%MSG_DELETE_FILES%
Run1.Path=%SOURCEDIR%
Run1.Command=del *80*.dll
Run2.Description=%MSG_DELETE_FILES%
Run2.Path=%SOURCEDIR%
Run2.Command=del Microsoft.VC80.*.manifest

;----------------------------------------------------------------------------------------
; 32-bit reboot message
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.40]
CheckCount=2
Check1.Description=%MSG_CHECK_REBOOT%
Check1.String=%NEED_REBOOT%
Check1.String.List=TRUE
;Check1.Success.Action=TMHF_CONTINUE
Check1.Success.AskOK=%MSG_SHOW_REBOOT_NEEDED%
Check1.Success.OK=TMHF_GOTOSTEP(44)
Check1.Success.Default=TMHF_GOTOSTEP(44)
Check1.Error.Action=TMHF_CONTINUE
Check2.Description=%MSG_CHECK_REBOOT%
Check2.Number=%DEF_SUPPORT_NEEDREBOOT%
Check2.Number.Min=%DEF_NEEDREBOOT%
Check2.Number.Max=%DEF_NEEDREBOOT%
;Check2.Success.Action=TMHF_GOTOSTEP(41)
Check2.Success.AskOK=%MSG_SHOW_REBOOT_NEEDED%
Check2.Success.OK=TMHF_GOTOSTEP(44)
Check2.Success.Default=TMHF_GOTOSTEP(44)
Check2.Error.Action=TMHF_GOTOSTEP(44)


;----------------------------------------------------------------------------------------
; 32-bit show program/engine/pattern versions
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.44]
CheckCount=1
Check1.Description=%MSG_CHECK_VERSION%
Check1.String=%DEF_REG_PRODUCT_VERSION%
Check1.String.List=%DEF_REG_PRODUCT_VERSION%

;----------------------------------------------------------------------------------------
; 32-bit last step
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.45]
CheckCount=1
Check1.Description=%MSG_CHECK_OS%
Check1.String=%OS_TYPE%
Check1.String.List=WIN2K,WINXP,WIN.NET,VISTA32,WIN7_32,WIN2008_32,WIN8_0_32,WIN8_1_32
Check1.Success.Action=TMHF_GOTOSTEP(100)

;----------------------------------------------------------------------------------------
; 32-bit error break
;----------------------------------------------------------------------------------------
[ProductInstall.Run.47]
;[TODO] Modify RunCount=2 if you need to delete Shared DLL
RunCount=0
Run1.Description=%MSG_DELETE_FILES%
Run1.Path=%SOURCEDIR%
Run1.Command=del *80*.dll
Run2.Description=%MSG_DELETE_FILES%
Run2.Path=%SOURCEDIR%
Run2.Command=del Microsoft.VC80.*.manifest
[ProductInstall.CheckRequirement.48]
CheckCount=1
Check1.Description="   "
Check1.Number=%RETCODE%
Check1.Success.Action=TMHF_USERBREAK
Check1.Error.Action=TMHF_USERBREAK

;========================================================================================
; 64-bit step block
;========================================================================================
;----------------------------------------------------------------------------------------
; 64-bit initialization
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.51]
CheckCount=2
Check1.Description=%MSG_CHECK_OS%
Check1.String=%OS_TYPE%
Check1.String.List=WIN.NET64,VISTA64,WIN7_64,WIN2008_64,WIN2008_R2_64,WIN8_0_64,WIN8_1_64,WIN2012_64,WIN2012_R2_64
Check1.Success.Action=TMHF_CONTINUE
;Check1.Error.Action=TMHF_GOTOSTEP(96)
Check1.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check1.Error.OK=TMHF_GOTOSTEP(98)
Check1.Error.Default=TMHF_GOTOSTEP(98)
Check2.Description=%MSG_CHECK_ADMIN%
Check2.String=%LOGIN_ACCOUNT%
Check2.String.List=ADMIN
Check2.Success.Action=TMHF_CONTINUE
Check2.Error.AskOK=%MSG_SHOW_ADMINISTRATOR_REQUIRED%
Check2.Error.OK=TMHF_GOTOSTEP(98)
Check2.Error.Default=TMHF_GOTOSTEP(98)

;----------------------------------------------------------------------------------------
; 64-bit version/language/code/id check
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.60]
CheckCount=4
Check1.Description=%MSG_CHECK_VERSION%
Check1.Number=%DEF64_PRODUCT_VER_FILE%
Check1.Number.Min=%DEF_SUPPORT_PRODUCT_VERSION_MIN%
Check1.Number.Max=%DEF_SUPPORT_PRODUCT_VERSION_MAX%
Check1.Success.Action=TMHF_CONTINUE
;Check1.Error.Action=TMHF_GOTOSTEP(96)
Check1.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check1.Error.OK=TMHF_GOTOSTEP(98)
Check1.Error.Default=TMHF_GOTOSTEP(98)
Check2.Description=%MSG_CHECK_VERSION%
Check2.Number=%DEF64_PRODUCT_VER_BUILD%
Check2.Number.Min=%DEF_SUPPORT_PRODUCT_VER_BUILD_MIN%
Check2.Number.Max=%DEF_SUPPORT_PRODUCT_VER_BUILD_MAX%
Check2.Success.Action=TMHF_CONTINUE
;Check2.Error.Action=TMHF_GOTOSTEP(96)
Check2.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check2.Error.OK=TMHF_GOTOSTEP(98)
Check2.Error.Default=TMHF_GOTOSTEP(98)
Check3.Description=%MSG_CHECK_NAME%
Check3.String=%DEF64_REG_PRODUCT_TITLE%
Check3.String.List=%DEF_SUPPORT_PRODUCT_TITLE%
Check3.Success.Action=TMHF_CONTINUE
;Check3.Error.Action=TMHF_GOTOSTEP(96)
Check3.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check3.Error.OK=TMHF_GOTOSTEP(98)
Check3.Error.Default=TMHF_GOTOSTEP(98)
Check4.Description=%MSG_CHECK_LANG%
Check4.Number=%DEF64_REG_LANGUAGE_ID%
Check4.Number.Min=%DEF_SUPPORT_LANGUAGE_ID%
Check4.Number.Max=%DEF_SUPPORT_LANGUAGE_ID%
Check4.Success.Action=TMHF_CONTINUE
;Check4.Error.Action=TMHF_GOTOSTEP(96)
Check4.Error.AskOK=%MSG_SHOW_NOT_COMPATIBLE%
Check4.Error.OK=TMHF_GOTOSTEP(98)
Check4.Error.Default=TMHF_GOTOSTEP(98)


;----------------------------------------------------------------------------------------
; 64-bit check session (with Module Control)
;----------------------------------------------------------------------------------------
[ProductInstall.Run.61]
;[TODO] Modify RunCount=2 if you need to copy Shared DLL
RunCount=2
Run1.Path=%SOURCEDIR%
Run1.Command=copy "%DEF64_REG_PRODUCT_PATH%*80*.dll" *80*.dll 
Run1.Description=%MSG_COPY_FILES%
Run2.Path=%SOURCEDIR%
Run2.Command=copy "%DEF64_REG_PRODUCT_PATH%\Microsoft.VC80.*.manifest" Microsoft.VC80.*.manifest
Run2.Description=%MSG_COPY_FILES%

[ProductInstall.Run.62]
RunCount=1
Run1.Description=%MSG_CHECK_SESSION%
Run1.Path=%SOURCEDIR%
Run1.Command=%DEF64_MODULE_NAME% /UserSession
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.63]
CheckCount=1
Check1.Description=%MSG_CHECK_SESSION%
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.Action=TMHF_GOTOSTEP(64)
;Check1.Error.Action=TMHF_GOTOSTEP(97)
Check1.Error.AskOK=%MSG_SHOW_LOGOUT_SESSION%
Check1.Error.OK=TMHF_GOTOSTEP(97)
Check1.Error.Default=TMHF_GOTOSTEP(97)

;----------------------------------------------------------------------------------------
; 64-bit stop helper
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.64]
CheckCount=1
Check1.Description=%MSG_HELPER_STOP%
Check1.Number=%DEF64_HELPER_VER_FILE%
Check1.Number.Min=%DEF_SUPPORT_HELPER_VERSION_INVALID%
Check1.Number.Max=%DEF_SUPPORT_HELPER_VERSION_INVALID%
Check1.Success.Action=TMHF_GOTOSTEP(67)
Check1.Error.Action=TMHF_CONTINUE
[ProductInstall.Run.65]
RunCount=1
Run1.Description=%MSG_HELPER_STOP%
Run1.Path=%DEF64_REG_PRODUCT_PATH%\
Run1.Command=%DEF64_HELPER_NAME% stop
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
Run1.RollbackCommand=%DEF64_HELPER_NAME% start
Run1.RollbackCommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.66]
CheckCount=1
Check1.Description=%MSG_HELPER_STOP%
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.Action=TMHF_CONTINUE
Check1.Error.Action=TMHF_GOTOSTEP(97)

;----------------------------------------------------------------------------------------
; 64-bit stop TMWK
;----------------------------------------------------------------------------------------
[ProductInstall.Run.67]
RunCount=1
Run1.Path=%SOURCEDIR%
Run1.Command=%DEF64_MODULE_NAME% /CheckUiInstance
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.68]
;if UI instance exist(RETCODE_S_OK), then do not continue
CheckCount=1
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.AskOK=%MSG_SHOW_CLOSE_UI%
Check1.Success.OK=TMHF_GOTOSTEP(97)
Check1.Success.Default=TMHF_GOTOSTEP(97)
Check1.Error.Action=TMHF_CONTINUE
[ProductInstall.Run.69]
RunCount=1
Run1.Description=%MSG_STOP_TMSL%
Run1.Path=%SOURCEDIR%
Run1.Command=%DEF64_MODULE_NAME% /Stop
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
Run1.RollbackCommand=%DEF64_MODULE_NAME% /Start
Run1.RollbackCommandType=TMHF_RunAtBackgroundAndWaitForReturn

;----------------------------------------------------------------------------------------
; 64-bit branch on os
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.74]
CheckCount=2
Check1.Description=%MSG_CHECK_OS%
Check1.Number=%DEF64_REG_FW_INSTALLED%
Check1.Number.Min=1
Check1.Number.Max=1
Check1.Success.Action=TMHF_CONTINUE
Check1.Error.Action=TMHF_GOTOSTEP(80)
Check2.Description=%MSG_CHECK_OS%
Check2.String=%OS_TYPE%
Check2.String.List=WINXP64
Check2.Success.Action=TMHF_CONTINUE
Check2.Error.Action=TMHF_GOTOSTEP(78)

[ProductInstall.CheckRequirement.78]
CheckCount=1
Check1.Description=%MSG_CHECK_OS%
Check1.String=%OS_TYPE%
Check1.String.List=WIN.NET64,VISTA64,WIN7_64,WIN2008_64,WIN2008_R2_64,WIN8_0_64,WIN8_1_64,WIN2012_64,WIN2012_R2_64
Check1.Success.Action=TMHF_CONTINUE
Check1.Error.Action=TMHF_GOTOSTEP(80)

;----------------------------------------------------------------------------------------
; 64-bit copy files
;----------------------------------------------------------------------------------------
[ProductInstall.CopyFileGroupTo.60]
FileGroupStartCount=60
FileGroupCount=4
[ProductInstall.CopyFileGroupTo.64]
FileGroupStartCount=64
FileGroupCount=2
[ProductInstall.CopyFileGroupTo.66]
FileGroupStartCount=66
FileGroupCount=2
[ProductInstall.CopyFileGroupTo.68]
FileGroupStartCount=68
FileGroupCount=3
;----------------------------------------------------------------------------------------
; 64-bit update registry
;----------------------------------------------------------------------------------------
[ProductInstall.UpdateRegistry.80]
RegCount=2
Reg1.Description=%MSG_UPDATE_REGISTRY%
Reg1.Key=Reg:REG_SZ,HKLM,%DEF_AEGIS_EXCEPTION_CONTROL_HELPER_REG_KEY%,Path,x64
Reg1.Value=%DEF64_REG_PRODUCT_PATH%\%DEF_HELPER_NAME%
Reg2.Description=%MSG_UPDATE_REGISTRY%
Reg2.Key=Reg:REG_DWORD,HKLM,%DEF_AEGIS_EXCEPTION_CONTROL_HELPER_REG_KEY%,Status,x64
Reg2.Value=%DEF_AEGIS_EXCEPTION_CONTROL_STATUS_NON_EXCEPTION%

;----------------------------------------------------------------------------------------
; 64-bit register helper
;----------------------------------------------------------------------------------------
[ProductInstall.Run.81]
RunCount=1
Run1.Description=%MSG_HELPER_REGISTER%
Run1.Path=%DEF64_REG_PRODUCT_PATH%\
Run1.Command=%DEF64_HELPER_NAME% register
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
Run1.RollbackCommand=%DEF64_HELPER_NAME% unregister
Run1.RollbackCommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.82]
CheckCount=1
Check1.Description=%MSG_HELPER_REGISTER%
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.Action=TMHF_GOTOSTEP(83)
Check1.Error.Action=TMHF_GOTOSTEP(97)

;----------------------------------------------------------------------------------------
; 64-bit start helper
;----------------------------------------------------------------------------------------
[ProductInstall.Run.83]
RunCount=1
Run1.Description=%MSG_HELPER_START%
Run1.Path=%DEF64_REG_PRODUCT_PATH%\
Run1.Command=%DEF64_HELPER_NAME% start
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn
Run1.RollbackCommand=%DEF64_HELPER_NAME% stop
Run1.RollbackCommandType=TMHF_RunAtBackgroundAndWaitForReturn
[ProductInstall.CheckRequirement.84]
CheckCount=1
Check1.Description=%MSG_HELPER_START%
Check1.Number=%RETCODE%
Check1.Number.Min=%RETCODE_S_OK%
Check1.Number.Max=%RETCODE_S_OK%
Check1.Success.Action=TMHF_GOTOSTEP(85)
Check1.Error.Action=TMHF_GOTOSTEP(97)


;----------------------------------------------------------------------------------------
; 64-bit start TMWK
;----------------------------------------------------------------------------------------
[ProductInstall.Run.85]
RunCount=1
Run1.Description=%MSG_START_TMSL%
Run1.Path=%SOURCEDIR%
Run1.Command=%DEF64_MODULE_NAME% /Start
Run1.CommandType=TMHF_RunAtBackgroundAndWaitForReturn

;----------------------------------------------------------------------------------------
; 64-bit remove shared files
;----------------------------------------------------------------------------------------
[ProductInstall.Run.89]
;[TODO] Modify RunCount=2 if you need to delete Shared DLL
RunCount=0
Run1.Description=%MSG_DELETE_FILES%
Run1.Path=%SOURCEDIR%
Run1.Command=del *80*.dll
Run2.Description=%MSG_DELETE_FILES%
Run2.Path=%SOURCEDIR%
Run2.Command=del Microsoft.VC80.*.manifest

;----------------------------------------------------------------------------------------
; 64-bit need reboot
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.90]
CheckCount=2
Check1.Description=%MSG_CHECK_REBOOT%
Check1.String=%NEED_REBOOT%
Check1.String.List=TRUE
;Check1.Success.Action=TMHF_CONTINUE
Check1.Success.AskOK=%MSG_SHOW_REBOOT_NEEDED%
Check1.Success.OK=TMHF_GOTOSTEP(94)
Check1.Success.Default=TMHF_GOTOSTEP(94)
Check1.Error.Action=TMHF_CONTINUE
Check2.Description=%MSG_CHECK_REBOOT%
Check2.Number=%DEF_SUPPORT_NEEDREBOOT%
Check2.Number.Min=%DEF_NEEDREBOOT%
Check2.Number.Max=%DEF_NEEDREBOOT%
;Check2.Success.Action=TMHF_GOTOSTEP(91)
Check2.Success.AskOK=%MSG_SHOW_REBOOT_NEEDED%
Check2.Success.OK=TMHF_GOTOSTEP(94)
Check2.Success.Default=TMHF_GOTOSTEP(94)
Check2.Error.Action=TMHF_GOTOSTEP(94)

;----------------------------------------------------------------------------------------
; 64-bit show program/engine/pattern versions
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.94]
CheckCount=1
Check1.Description=%MSG_CHECK_VERSION%
Check1.String=%DEF64_REG_PRODUCT_VERSION%
Check1.String.List=%DEF64_REG_PRODUCT_VERSION%

;----------------------------------------------------------------------------------------
; 64-bit last step
;----------------------------------------------------------------------------------------
[ProductInstall.CheckRequirement.95]
CheckCount=1
Check1.Description=%MSG_CHECK_OS%
Check1.String=%OS_TYPE%
Check1.String.List=WIN.NET64,VISTA64,WIN7_64,WIN2008_64,WIN2008_R2_64,WIN8_0_64,WIN8_1_64,WIN2012_64,WIN2012_R2_64
Check1.Success.Action=TMHF_GOTOSTEP(100)

;----------------------------------------------------------------------------------------
; 64-bit error break
;----------------------------------------------------------------------------------------
[ProductInstall.Run.97]
[TODO] Modify RunCount=2 if you need to delete Shared DLL
RunCount=0
Run1.Description=%MSG_DELETE_FILES%
Run1.Path=%SOURCEDIR%
Run1.Command=del *80*.dll
Run2.Description=%MSG_DELETE_FILES%
Run2.Path=%SOURCEDIR%
Run2.Command=del Microsoft.VC80.*.manifest
[ProductInstall.CheckRequirement.98]
CheckCount=1
Check1.Description="   "
Check1.Number=%RETCODE%
Check1.Error.Action=TMHF_USERBREAK
Check1.Success.Action=TMHF_USERBREAK
;----------------------------------------------------------------------------------------
; 32/64-bit last step
;----------------------------------------------------------------------------------------
[ProductInstall.Run.100]
;[TODO] Modify RunCount=2 if you need to delete Shared DLL
RunCount=0
Run1.Description=%MSG_DELETE_FILES%
Run1.Path=%SOURCEDIR%
Run1.Command=del *80*.dll
Run2.Description=%MSG_DELETE_FILES%
Run2.Path=%SOURCEDIR%
Run2.Command=del Microsoft.VC80.*.manifest
[ProductInstall.CheckRequirement.100]
CheckCount=1
Check1.Description="   "
Check1.Number=%RETCODE%
Check1.Error.Action=TMHF_USERBREAK
Check1.Success.Action=TMHF_USERBREAK
